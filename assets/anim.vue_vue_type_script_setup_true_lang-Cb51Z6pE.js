import{d as V,r as N,K as F,N as G,z as H,E as Q,f as j,o as O,j as P,aQ as R,aR as z,e as K,w as X}from"./modules/vue-DcGPefT6.js";import{u as D}from"./slidev/context-DDVT8oB6.js";import{at as _}from"./index-BNjHXp7a.js";let Y=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/uig;a.year=a.yr=a.y=6e4*60*24*365.25;a.month=a.b=6e4*60*24*(365.25/12);a.week=a.wk=a.w=6e4*60*24*7;a.day=a.d=6e4*60*24;a.hour=a.hr=a.h=6e4*60;a.minute=a.min=a.m=6e4;a.second=a.sec=a.s=1e3;a.millisecond=a.millisec=a.ms=1;a.µs=a.μs=a.us=a.microsecond=1/1e3;a.nanosecond=a.ns=1/1e6;function a(w="",A="ms"){var L=null,M;return w=(w+"").replace(/(\d)[,_](\d)/g,"$1$2"),w.replace(Y,function(q,C,h){if(h)h=h.toLowerCase();else if(M){for(var y in a)if(a[y]<M){h=y;break}}else h=A;Object.prototype.hasOwnProperty.call(a,h)?h=a[h]:Object.prototype.hasOwnProperty.call(a,h.replace(/s$/,""))?h=a[h.replace(/s$/,"")]:h=null,h&&(L=(L||0)+Math.abs(parseFloat(C,10))*h,M=h)}),L&&L/(a[A]||1)*(w[0]==="-"?-1:1)}const k=new CSSStyleSheet;k.replaceSync(`
:root {
	--anim-show-duration: 400ms;
	--anim-hide-duration: 100ms;
	--anim-step-opacity: 0.15;
}
.anim-shown { opacity: 1; transition: all var(--anim-show-duration); }
.anim-hidden { opacity: 0; transition: all var(--anim-hide-duration); }
.anim-nowable, .anim-nowable ~ * { transition: all var(--anim-show-duration) ease-out; }
.anim-notnow, .anim-now ~ * { opacity: var(--anim-step-opacity); transition-duration: 0ms !important; transition-timing-function: ease-out; }
/* css is tricky (and imperfect) with nested lists... */
`);const I=w=>{w.adoptedStyleSheets=w.adoptedStyleSheets.filter(A=>!A.__isAnimStyleSheet),k.__isAnimStyleSheet=!0,w.adoptedStyleSheets.push(k)};I(globalThis.document);const W=(w,A,L,M=!0)=>{L.indexOf("::part(");const q=f=>{if(f.indexOf("::shadow")!==-1)return f.split("::shadow");if(f.indexOf("::part(")!==-1){const e=f.split("::part(");return e.length!==2&&globalThis.console.log("WARNING: non-2-length parts",e),e[0]===""&&globalThis.console.log("WARNING: performance risk with non-prefixed ::part()",f),e[0].indexOf(",")!==-1&&globalThis.console.log("WARNING: found a comma on the left of ::part(), this might not be well handled",f),[e[0],"::part("+e[1]]}return[f]};let[C,h]=q(L);if(h===void 0)return w?A.querySelectorAll(L):A.querySelector(L);let y=[...A.querySelectorAll(C||"*")];return globalThis.console.log("1",w,y),M&&y.some(f=>f.shadowRoot)&&y.forEach(f=>f.shadowRoot?I(f.shadowRoot):"pass"),h===""?y=y.map(f=>{var e;return(e=f.shadowRoot)==null?void 0:e.children}):y=y.map(f=>{var e;return(e=f.shadowRoot)==null?void 0:e.querySelectorAll(h)}),globalThis.console.log("2",w,y),y=y.flatMap(f=>f?[...f]:[]),globalThis.console.log("3",w,y),w?y:y[0]??null},J=V({__name:"Anim",props:{spec:{default:()=>"@step 1-"},at:{type:[String,Number],default:"+1"},dur:{type:String,default:"300ms"}},setup(w){const{$clicksContext:A}=D(),L=w,M={show:{doit({all:e},s){e(s,t=>t.classList.add("anim-shown")),e(s,t=>t.classList.remove("anim-hidden"))},undo({all:e},s){e(s,t=>t.classList.add("anim-hidden")),e(s,t=>t.classList.remove("anim-shown"))}},hide:{doit({all:e},s){e(s,t=>t.classList.remove("anim-shown")),e(s,t=>t.classList.add("anim-hidden"))},undo({all:e},s){e(s,t=>t.classList.remove("anim-hidden")),e(s,t=>t.classList.add("anim-shown"))}},highlight:{doit({all:e},s){e(s,t=>t.classList.remove("dishonored")),e(s,t=>t.classList.remove("dishonored2")),e(s,t=>t.classList.add("highlighted"))},undo({all:e},s){e(s,t=>t.classList.remove("highlighted")),e(s,t=>t.classList.add("dishonored")),e(s,t=>t.classList.add("dishonored2"))}},unhighlight:{doit({all:e},s){e(s,t=>t.classList.remove("highlighted")),e(s,t=>t.classList.add("dishonored")),e(s,t=>t.classList.add("dishonored2"))},undo({all:e},s){e(s,t=>t.classList.remove("dishonored")),e(s,t=>t.classList.remove("dishonored2")),e(s,t=>t.classList.add("highlighted"))}},inlineShow:{doit({all:e},s){e(s,t=>t.style.opacity=1)},undo({all:e},s){e(s,t=>t.style.opacity=0)}},inlineHide:{doit({all:e},s){e(s,t=>t.style.opacity=0)},undo({all:e},s){e(s,t=>t.style.opacity=1)}},addClass:{doit({all:e},s,t){e(t,n=>n.classList.add(s))},undo({all:e},s,t){e(t,n=>n.classList.remove(s))}},removeClass:{doit({all:e},s,t){e(t,n=>n.classList.remove(s))},undo({all:e},s,t){e(t,n=>n.classList.add(s))}},step:{init({el:e}){},doit({el:e,all:s,querySelectorAll:t},n){e.classList.remove("anim-notnow"),s(".anim-now",d=>d.classList.remove("anim-now"));let i=t(".step")[n-1];for(;i&&i!==e;)i.classList.add("anim-now"),i=i.parentElement},undo({all:e,querySelector:s,querySelectorAll:t,el:n,willDo:i},d){{let u=t(".step")[d-1];for(;u&&u!==n;)u.classList.add("anim-nowable"),u=u.parentElement}n.classList.add("anim-nowable"),n.classList.remove("anim-notnow"),e(".anim-now",u=>u.classList.remove("anim-now"));let l=s(".step0");for(l===null&&n.classList.add("anim-notnow");l&&l!==n;)l.classList.add("anim-now"),l=l.parentElement}},viewBoxAs:{init({querySelector:e},s){const t=e(s);if(t!==null&&t.viewportElement!==void 0){const n=t.viewportElement||t;n.baseViewBox===void 0?n.baseViewBox=n.getAttribute("viewBox")??"":n.setAttribute("viewBox",n.baseViewBox)}},doit({querySelector:e,fast:s},t,n){const i=a(n,"ms"),d=(r,m,p)=>[m*r.a+p*r.c+r.e,m*r.b+p*r.d+r.f],l=r=>r[0].map((m,p)=>r.map(o=>o[p])),u=(r,m)=>{const p=m.getScreenCTM().inverse().multiply(r.getScreenCTM()),o=r.getBBox(),c=[[o.x,o.y],[o.x+o.width,o.y],[o.x+o.width,o.y+o.height],[o.x,o.y+o.height]],S=l(c.map(([v,g])=>d(p,v,g))),E=Math.min(...S[0]),b=Math.min(...S[1]);return[E,b,Math.max(...S[0])-E,Math.max(...S[1])-b]},x=e(t);if(x!==null&&x.viewportElement!==void 0){const r=x.viewportElement||x;if(r.getScreenCTM()===null)return;const m=u(x,r);if(s)r.setAttribute("viewBox",m.join(" "));else{const p=r.getAttribute("viewBox");r.currentViewBoxAnimate=R({from:p,to:m.join(" "),duration:i,onUpdate:o=>r.setAttribute("viewBox",o)})}}},undo({querySelector:e},s){var n,i;const t=e(s);if(t!==null&&t.viewportElement!==void 0){const d=t.viewportElement||t;(i=(n=d.currentViewBoxAnimate)==null?void 0:n.stop)==null||i.call(n),d.currentViewBoxAnimate=void 0}}},moveAlong:{init({all:e},s,t,n){e(n,i=>{i.dataNextStart=[0,0],i.viewportElement!==void 0?i.baseTransform===void 0?i.baseTransform=i.getAttribute("transform")??"":i.setAttribute("transform",i.baseTransform):i.baseTransform===void 0?i.baseTransform=i.style.transform:i.style.transform=i.baseTransform})},doit({all:e,fast:s,querySelector:t},n,i,d){const l=a(i,"ms"),u=n.startsWith("-"),x=t(n.substr(u?1:0));x!==null&&e(d,r=>{let m=r.dataNextStart;const p=x.getTotalLength(),o=x.getPointAtLength(u?p:0),c=x.getPointAtLength(u?0:p);r.dataNextStart=[m[0]+c.x-o.x,m[1]+c.y-o.y];const S=E=>{const b=x.getPointAtLength((u?1-E:E)*p);r.viewportElement!==void 0?r.setAttribute("transform",`translate(${b.x-o.x+m[0]} ${b.y-o.y+m[1]}) ${r.baseTransform}`):r.style.transform=`translate(${b.x-o.x+m[0]}px, ${b.y-o.y+m[1]}px) ${r.baseTransform}`};if(s){S(1);return}r.currentMoveAlongAnimate=R({from:0,to:1,onUpdate:S,duration:l})})},undo({all:e},s,t,n){e(n,i=>{var d,l;(l=(d=i.currentMoveAlongAnimate)==null?void 0:d.stop)==null||l.call(d),i.currentMoveAlongAnimate=void 0})}}};function q(e=5){const s=[],t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=t.length;for(let i=0;i<e;i++)s.push(t.charAt(Math.floor(Math.random()*n)));return s.join("")}const C=e=>s=>{function t(o){return s.startsWith(o)?(s=s.substring(o.length),!0):!1}function n(o){const c=s.match(o);if(c==null)throw`Cannot match «${o}» in «${s}»`;const S=s.substring(0,c.index);return s=s.substring(c.index+c[0].length),S}if(t("++"))return["inlineShow",s];if(t("--"))return["inlineHide",s];if(t("+"))return["show",s];if(t("-"))return["hide",s];if(t("@+class "))return["addClass",n(/ +/),s];if(t("@-class "))return["removeClass",n(/ +/),s];if(t("@along "))return["moveAlong",n(/ +/),e.defaultDuration,s];if(t("@alongd ")){const o=n(/ +/),c=n(/ +/);return["moveAlong",o,c,s]}if(t("@viewbox "))return["viewBoxAs",s,e.defaultDuration];if(t("@viewboxd "))return["viewBoxAs",n(/ +/),s];if(t("@step ")){const o=_(e.nStepElements()+1,s);return o.length>1&&e.forbidComposite?(alert("@steps is not allowed here (e.g. in ^ separated steps), use @step"),[]):o.length===1?["step",o[0]]:o.map(c=>[["step",c]])}const i=".mtable",d=".mtable:first-of-type",l=">* .vlist>span:not(.vlist .vlist span)",u=i+l;if(t("@math ")){let o=s,c="",S=!1,E=!0;try{o=n(/ +/),c=s+" "}catch{}if(o.startsWith("[")){if(!o.trimEnd().endsWith("]"))return alert("@math with a range spec must end in ] (and must not contain spaces)"),[];E=!1,o=o.trimEnd().slice(1,-1)}else if(o.startsWith("{")){if(!o.trimEnd().endsWith("}"))return alert("@math with a slidev range spec must end in } (and must not contain spaces)"),[];S=!0,o=o.trimEnd().slice(1,-1)}if(S){const b=o.split(/\|/g).map(g=>_(e.nMathElements(c),g)),v=[];for(const g of b){const B=[];v.push(B);for(const $ of e.elValue().querySelectorAll(c+d))$.querySelectorAll(":scope "+l).forEach((U,T)=>{B.push([g.includes(T+1)?"highlight":"unhighlight",c+u+":nth-of-type("+(T+1)+")"])})}return v}else{const b=o.split(/\|/g).map(g=>_(e.nMathElements(c),g));let v=[];for(const g of b)v.push(g.map(B=>["show",c+u+":nth-of-type("+B+")"]));return E&&(v=v.flat().map(g=>[g])),v.length>1&&e.forbidComposite?(alert("@math with a range is not allowed here (e.g. in ^ separated steps)"),[]):v}}const x="pre.slidev-code>code",r="pre.slidev-code:first-of-type>code",m=">span.line",p=x+m;if(t("@code ")){let o=s,c="",S=!1,E=!0;try{o=n(/ +/),c=s+" "}catch{}if(o.startsWith("[")){if(!o.trimEnd().endsWith("]"))return alert("@code with a range spec must end in ] (and must not contain spaces)"),[];E=!1,o=o.trimEnd().slice(1,-1)}else if(o.startsWith("{")){if(!o.trimEnd().endsWith("}"))return alert("@code with a slidev range spec must end in } (and must not contain spaces)"),[];S=!0,o=o.trimEnd().slice(1,-1)}if(S){const b=o.split(/\|/g).map(g=>_(e.nCodeElements(c),g)),v=[];for(const g of b){const B=[];v.push(B);for(const $ of e.elValue().querySelectorAll(c+r))$.querySelectorAll(":scope "+m).forEach((U,T)=>{B.push([g.includes(T+1)?"highlight":"unhighlight",c+p+":nth-of-type("+(T+1)+")"])})}return v}else{const b=o.split(/\|/g).map(g=>_(e.nCodeElements(c),g));let v=[];for(const g of b)v.push(g.map(B=>["show",c+p+":nth-of-type("+B+")"]));return E&&(v=v.flat().map(g=>[g])),v.length>1&&e.forbidComposite?(alert("@code with a range is not allowed here (e.g. in ^ separated steps)"),[]):v}}return s.startsWith("@")&&alert("Unhandled @ animation: "+s),["show",s]},h=N(),y=e=>{const{dur:s}=L,t={defaultDuration:s,elValue:()=>e,nStepElements:()=>e.querySelectorAll(".step").length,nMathElements:(d="")=>Math.max(...[...e.querySelectorAll(d+".mtable>* .vlist")].map(l=>l.querySelectorAll(":scope>span:not(.vlist .vlist span)").length)),nCodeElements:d=>Math.max(...[...e.querySelectorAll(d+" pre.slidev-code:first-of-type>code")].map(l=>l.querySelectorAll(":scope>span.line").length))},n=L.spec.trim();if(n.length==0)return[];const i=[];return n.split(/\| /g).forEach(d=>{if(d.trim().match(/ +\^ +/)){const l=[];i.push(l),d.trim().split(/ +\^ +/g).map(C({...t,forbidComposite:!0})).forEach(u=>{typeof(u==null?void 0:u[0])=="string"?l.push(u):(u.length>2&&alert("Too many steps while forbidComposite:true was passed"),l.push(...u[0]))})}else{let l=C(t)(d.trim());typeof(l==null?void 0:l[0])=="string"?i.push([l]):i.push(...l)}}),i},f=N(()=>{});return F(()=>{const e=y(h.value),s=q(),t=A.calculateSince(L.at,e.length);A.register(s,t),G(()=>A.unregister(s));const n=H(()=>t?Math.max(0,A.current-t.start+1):999999);let i;f.value=()=>{var u,x;if(!h.value){i=void 0;return}const d=i;i=n.value;const l={all:(r,m)=>W(!0,h.value,r).forEach(m),querySelector:r=>W(!1,h.value,r),querySelectorAll:r=>W(!0,h.value,r),el:h.value};for(let r=e.length-1;r>=0;--r)for(const m of e[r]){const[p,...o]=m;M[p]?(x=(u=M[p]).init)==null||x.call(u,l,...o):alert("Action not found: "+p)}for(let r=e.length-1;r>=0;--r){const m=r<n.value;for(const p of e[r]){const[o,...c]=p;M[o].undo({...l,willDo:m},...c)}}for(let r=0;r<n.value;++r){const m=n.value-d,p=r<n.value-1||m<1||m>1||d===void 0&&n.value==e.length-1,o=r==n.value-1;for(const c in e[r]){const S=e[r][c],[E,...b]=S;M[E].doit({...l,fast:p,last:o},...b)}}},Q(f.value)}),z("notifyAsyncDone",f),(e,s)=>(O(),j("div",{ref_key:"el",ref:h},[P(e.$slots,"default")],512))}}),Z={class:"slidev-layout default"},oe=V({__name:"anim",props:{spec:{type:String}},setup(w){D();const A=w;return(L,M)=>(O(),j("div",Z,[K(J,{spec:A.spec},{default:X(()=>[P(L.$slots,"default")]),_:3},8,["spec"])]))}});export{oe as _};
